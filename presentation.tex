\documentclass[aspectratio=169]{beamer}

% ==============================
% ==  Основные пакеты и тема  ==
% ==============================
\usetheme{metropolis}

\usepackage{fontspec}
\usepackage{amssymb}
\setsansfont{Fira Sans}
\setmonofont{Fira Code}

\usepackage{tikz}
\usetikzlibrary{arrows.meta, positioning, shapes.multipart}

% Ячейка для окружения
\tikzset{
    env-node/.style={
        rectangle split, rectangle split parts=#1,
        draw=green!60!black,
        fill=green!5,
        rounded corners,
        thick,
        align=center
    },
}

% ==============================
% ==        Метаданные        ==
% ==============================
\title{10. Хвостовая рекурсия и замыкание лямбда-процедур в языке Scheme}
\institute{Курс: Основы информатики}
\date{}

% ==============================
% ==      Блоки с кодом       ==
% ==============================

% Настройки для блоков с кодом
\usepackage{minted}
\usepackage[svgnames]{xcolor}
\definecolor{bg}{rgb}{0.95,0.95,0.95}
\newminted{scheme}{
    fontsize=\scriptsize,
    linenos,
    numbersep=8pt,
    gobble=4,
    frame=lines,
    bgcolor=bg,
    framesep=3mm,
    escapeinside=||
}

% Тривиальная реализация факториала
\newsavebox{\codeFactorialSimple}
\begin{lrbox}{\codeFactorialSimple}
    \begin{minipage}{0.4\textwidth}
        \begin{schemecode}
(define (f1 n)
  (if (= n 0)
      1
      (* (f1 (- n 1)) n)))
        \end{schemecode}
    \end{minipage}
\end{lrbox}

% Хвостовая рекурсия для факториала
\newsavebox{\codeFactorialTailRec}
\begin{lrbox}{\codeFactorialTailRec}
    \begin{minipage}{0.4\textwidth}
        \begin{schemecode}
(define (f2 n acc)
  (if (= n 0)
    acc
    (f2 (- n 1) (* n acc))))
        \end{schemecode}
    \end{minipage}
\end{lrbox}

% Пример замыкания лямбда-процедуры
\newsavebox{\codeLambdaExample}
\begin{lrbox}{\codeLambdaExample}
    \begin{minipage}{0.4\textwidth}
        \begin{schemecode}
(define (f x)
  (+ (g (lambda (y)
        (* x y))) 3))

(define (g h)
    (h (h 7)))
        \end{schemecode}
    \end{minipage}
\end{lrbox}

% Пример замыкания для счетчика
\newsavebox{\codeClosureCounter}
\begin{lrbox}{\codeClosureCounter}
    \begin{minipage}{0.4\textwidth}
        \begin{schemecode}
(define counter
  ((lambda (n)
    (lambda ()
      (set! n (+ n 1))
      n))
    0))
        \end{schemecode}
    \end{minipage}
\end{lrbox}

% ==============================
% ==         Документ         ==
% ==============================
\begin{document}

% Титульный слайд
\begin{frame}
    \titlepage
\end{frame}

% ============================
% ==        Глава 1.        ==
% ==                        ==
% == Оптимизация хвостовой  ==
% ==        рекурсии        ==
% ============================
\input{slides/1-1}
\input{slides/1-2}

% ============================
% ==        Глава 2.        ==
% ==                        ==
% ==    Замыкание лямбды    ==
% ============================
\input{slides/2-1}
\input{slides/2-2}

\end{document}
